<template>
    <div class="children-cat page">
        <main class="personal-area">
            <section class="title-pages">
                <div class="container">
                    <div class="top-title">
                        <h1>
                            {{currentCat}}
                        </h1>
                        <p>
                            Сервисы, похожие на Яндекс.Почта относятся к сфере электронная почта. Список отсортирован в
                            порядке уместности.
                            Чтобы найти подходящий аналог, сравните сервисы, прочтите описание и отзывы.
                        </p>
                    </div>
                </div>
            </section>
            <section class="description-box">
                <div class="container">
                    <div class="description-box--content">
                        <div class="description-box--content_elements">
<!--                            {{servicesList[0]}}-->
                            <div class="description-el" v-for="(des,index) in servicesList"
                            >
                                <div class="description-el--top-content">
                                    <div class="logo-box">
                                        <nuxt-link :to="'/services/' + des.id" class="img-box">
                                            <div v-if="des.logo">
                                                <img :src="urlImage + 'services/' + des.logo" />
                                            </div>
                                            <div v-else><img src="/images/others/notimage.png"></div>
                                        </nuxt-link>
                                        <div class="rating-box">
                                            <el-rate
                                                v-model="des.assessmentRecommend"
                                                disabled
                                                :colors="colors">
                                            </el-rate>
                                            <p> ({{ des.reviews }} отзыв)</p>
                                        </div>
                                    </div>
                                    <div class="text-box">
                                        <div class="advertising" :class="{ 'is-active': des.advertising }">
                                            Реклама
                                        </div>
                                        <nuxt-link :to="'/services/' + des.id">
                                            {{ des.title }}
                                        </nuxt-link>
                                        <p v-if="des.desc">
                                            {{ des.desc | cutText }}
                                        </p>
                                        <p v-else>{{des.content | cutText }}</p>
                                    </div>
                                    <div class="controls-box">
                                        <a :href="des.linkSite" target="_blank" data-text="Сайт" ></a>
                                        <div class="controls-box--input bookmarks-el">
                                            <input :id="'control1.0.1' + des.id" type="checkbox">
                                            <label :for="'control1.0.1' + des.id">
                                                В закладки
                                            </label>
                                        </div>
                                        <div class="controls-box--input">
                                            <input :id="'control1.0.2' + des.id" type="checkbox" :value="des.id" v-model="checkedServices" @change="changeCompare">
                                            <label :for="'control1.0.2' + des.id">
                                                Сравнить
                                            </label>
                                        </div>
                                        <div class="controls-box--input">
                                            <input :id="'control1.0.3' + des.id" type="checkbox">
                                            <label :for="'control1.0.3' + des.id">
                                                Использую
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="description-el--bottom-content" :class="{'is-active':mobile_list == index}" >
                                    <div class="will-do--category">
                                        <div class="top-box">
                                            <p>м <span>Малый бизнес</span></p>
                                            <p>с <span>Средний бизнес</span></p>
                                            <p>к <span>Крупный бизнес</span></p>
                                        </div>
                                        <div class="bottom-box">
                                            <span>B2B</span>
                                            <span>B2C</span>
                                        </div>

                                    </div>
                                    <div class="show-bottom--content">
                                        <p>Подойдёт для:</p>
                                        <div class="will-do">
                                            <div class="will-row">
                                                <input id="el1.1" type="checkbox">
                                                <label for="el1.1">
                                                    менеджер
                                                </label>
                                            </div>
                                            <div class="will-row">
                                                <input id="el1.2" type="checkbox">
                                                <label for="el1.2">
                                                    маркетолог
                                                </label>
                                            </div>
                                            <div class="will-row">
                                                <input id="el1.3" type="checkbox">
                                                <label for="el1.3">
                                                    блогер
                                                </label>
                                            </div>
                                            <div class="will-row">
                                                <input id="el1.4" type="checkbox">
                                                <label for="el1.4">
                                                    бизнес
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="arrow-show" :class="{'is-active':mobile_list == index}" @click="show_list_mobile(index)">
                                    <span v-if="mobile_list == index">
                                       Скрыть
                                    </span>
                                        <span v-else>
                                        Показать
                                    </span>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <aside>
                            <div class="button-filter--visible" @click="filterVisible = !filterVisible">
                                <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="filter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-filter fa-w-16 fa-3x"><path fill="currentColor" d="M487.976 0H24.028C2.71 0-8.047 25.866 7.058 40.971L192 225.941V432c0 7.831 3.821 15.17 10.237 19.662l80 55.98C298.02 518.69 320 507.493 320 487.98V225.941l184.947-184.97C520.021 25.896 509.338 0 487.976 0z" class=""></path></svg>
                            </div>
                            <div :class="{ 'is-active': filterVisible }" class="filters-content-box">
                                <form action="">
                                    <div class="filters-box"  :class="{ 'is-active': inputEl }">
                                        <h4 @click="inputEl = !inputEl" :class="{ 'is-active': inputEl }">Коллаборации</h4>
                                        <div  class="input-container">
                                            <div class="input-box">
                                                <input type="checkbox" id="1.1">
                                                <label for="1.1">Финансы </label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="1.2">
                                                <label for="1.2">Финансы </label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="1.3">
                                                <label for="1.3">Финансы </label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="1.4">
                                                <label for="1.4">Финансы </label>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="filters-box"  :class="{ 'is-active': inputEl1 }">
                                        <h4 @click="inputEl1 = !inputEl1" :class="{ 'is-active': inputEl1 }">Collaboration1</h4>
                                        <div class="input-container">
                                            <div class="input-box">
                                                <input type="checkbox" id="2.1">
                                                <label for="2.1">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="2.2">
                                                <label for="2.2">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="2.3">
                                                <label for="2.3">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="2.4">
                                                <label for="2.4">Collaboration</label>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="filters-box"  :class="{ 'is-active': inputEl2 }">
                                        <h4 @click="inputEl2 = !inputEl2" :class="{ 'is-active': inputEl2 }">Collaboration2</h4>
                                        <div class="input-container">
                                            <div class="input-box">
                                                <input type="checkbox" id="3.1">
                                                <label for="3.1">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="3.2">
                                                <label for="3.2">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="3.3">
                                                <label for="3.3">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="3.4">
                                                <label for="3.4">Collaboration</label>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="filters-box"  :class="{ 'is-active': inputEl3 }">
                                        <h4 @click="inputEl3 = !inputEl3" :class="{ 'is-active': inputEl3 }">Collaboration3</h4>
                                        <div class="input-container">
                                            <div class="input-box">
                                                <input type="checkbox" id="4.1">
                                                <label for="4.1">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="4.2">
                                                <label for="4.2">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="4.3">
                                                <label for="4.3">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="4.4">
                                                <label for="4.4">Collaboration</label>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="filters-box"  :class="{ 'is-active': inputEl4}">
                                        <h4 @click="inputEl4 = !inputEl4" :class="{ 'is-active': inputEl4 }">Collaboration4</h4>
                                        <div class="input-container">
                                            <div class="input-box">
                                                <input type="checkbox" id="5.1">
                                                <label for="5.1">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="5.2">
                                                <label for="5.2">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="5.3">
                                                <label for="5.3">Collaboration</label>
                                            </div>
                                            <div class="input-box">
                                                <input type="checkbox" id="5.4">
                                                <label for="5.4">Collaboration</label>
                                            </div>
                                        </div>

                                    </div>
                                </form>
                            </div>
                            <div class="aside-content">
                                <h2>
                                    Похожие категории
                                </h2>
                                <ul>
                                    <li v-for="item in catList">
                                        <a href="#" @click="selectCat(item.label)">{{item.label}}</a>
                                    </li>
                                </ul>
                                <nuxt-link to="/catalogs">
                                    <span data-text="Все категории"></span>
                                </nuxt-link>

                            </div>
                        </aside>


                    </div>
                </div>

                <div class="compare" v-if="compareData.length > 0">
                    <div class="container">
                        <h6>Сравнить (<span>{{compareData.length}}</span>) {{currentCat}}</h6>
                        <div class="compare-content--box">
                            <div class="compare-content">
                                <div class="compare-box img-el" v-for="item in compareData">
                                    <img v-if="item.logo" :src="urlImage + 'services/' + item.logo" />
                                    <img v-else src="/images/others/notimage.png">
                                    <span  @click="removeCompare(item.id)"></span>
                                </div>
                                <div class="compare-box">
                                    <span></span>
                                </div>
                            </div>
                            <div class="button-box">
                            <span class="compare-button" data-compare="Сравнить сейчас" @click="compareStart">

                            </span>
                                <span class="reset-compare" @click="clearCompare">Очистить список</span>
                            </div>
                        </div>
                    </div>
                </div>

            </section>

        </main>

    </div>
</template>

<script>
    const baseUrlUploads = process.env.baseUrlImage;
    export default {
        name: "children_cat_index",
        data(){
            return {
                urlImage: baseUrlUploads,
                inputEl:false,
                inputEl1:false,
                inputEl2:false,
                inputEl3:false,
                inputEl4:false,
                filterVisible: null,
                name: '',
                catList: [],
                servicesList: [],
                checkedServices: [],
                compareData: [],
                mobile_list: null,
                colors: ['#99A9BF', '#F7BA2A', '#FF9900'],
            }
        },
        methods: {
            changeCompare(){
                let allCheck = this.checkedServices;
                let allServiceCat = this.servicesList;
                let compare = [];
                for (let i = 0; i < allCheck.length; i++) {
                    let id = allCheck[i]
                    let targetCompare = allServiceCat.find((item) => {
                        if(item.id === id){return true}});
                    if(targetCompare){
                        compare.push(targetCompare)
                    }
                }
                this.compareData = compare
            },
            clearCompare(){
                this.checkedServices = [];
                this.compareData = [];
            },
            removeCompare(id){
                const unCheckEl = document.getElementById('control1.0.2' + id);
                unCheckEl.click();
            },
            compareStart(){
                //compareData
                this.$store.dispatch('data/compare/GET_COMPARE', this.compareData);
                this.$router.push('/comparison')
            },
            getServices(cat){
                let servicesArr = []
                let lists = this.servicesAll;

                for (let i = 0; i < lists.length; i++) {
                    let catalogs = lists[i].cat
                    let format = this.formatCats(catalogs, cat)
                    if(format){
                        servicesArr.push(lists[i])
                    }
                }
                this.servicesList = servicesArr
                // let cop = this.servicesList
                // for (let i = 0; i < cop.length; i++) {
                //     let formatBuss = this.formatArr(cop[i].business)
                //     cop[i].business = formatBuss
                // }
                // console.log(cop)
            },
            formatArr(arr){
                if(arr){
                    let mas = [],
                        j = 0;
                    for (let i = 0; i < arr.length; i++) {
                        if (arr[i] == ",") { j++; continue; }
                        else {
                            mas[j] ? mas[j] += arr[i] : mas[j] = arr[i];
                        }
                    }
                    return mas;
                }
            },
            formatCats(catalogs, cat){
                if(catalogs){
                    let mas = [],
                        j = 0;
                    for (let i = 0; i < catalogs.length; i++) {
                        if (catalogs[i] == ",") { j++; continue; }
                        else {
                            mas[j] ? mas[j] += catalogs[i] : mas[j] = catalogs[i];
                        }
                    }
                    for (let i = 0; i < mas.length; i++) {
                        if(mas[i] === cat){
                            return true
                        }
                    }
                }
            },
            show_list_mobile(index) {
                if(index == this.mobile_list){
                    this.mobile_list = null
                }else{
                    this.mobile_list = index
                }
            },
            selectCat(cat){
                this.$store.dispatch('data/search/GET_ACTIVE_CAT', cat)
            },
            getCats(cat, type){
                if(cat.length){
                    this.getServices(cat)
                    if(type !== 'change'){
                        let categoriesAll = this.categoryAll;
                        let childrenCat = [];
                        for (let i = 0; i < categoriesAll.length; i++) {
                            let catList = categoriesAll[i].categoryAll;
                            let targetCat = catList.find((item) => {
                                if(item.label === cat){return true}});
                            if(targetCat){
                                this.$store.dispatch('data/search/GET_PARENT_CAT', categoriesAll[i].label)
                                childrenCat.push(catList);
                            }
                        }
                        this.catList = childrenCat[0]
                    }
                } else {
                    this.$router.push('/catalogs')
                }
            }
        },
        filters: {
            cutText(value) {
                let number = 150;
                return value.length > number
                    ? value.slice(0, number - 3) + '...'
                    : value;
            }
        },
        watch: {
            currentCat(){
                this.getCats(this.currentCat, 'change')
            }
        },
        mounted() {
            this.name = this.$store.state.data.search.activeCat;
            this.getCats(this.name)
        },
        computed: {
            currentCat() {
                return this.$store.state.data.search.activeCat;
            },
            categoryAll() {
                return this.$store.state.data.category_data.categoryAll;
            },
            servicesAll() {
                return this.$store.state.data.services.services;
            },
        }
    }
</script>

<style scoped>

</style>
