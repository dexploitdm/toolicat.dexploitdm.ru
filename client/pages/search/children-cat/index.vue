<template>
    <div class="children-cat page">
<!--        <div class="title-box">-->
<!--            <h1 class="title-h1"></h1>-->
<!--        </div>-->
<!--        {{currentCat}}-->
        <main class="personal-area">
            <section class="title-pages">
                <div class="container">
                    <div class="top-title">
                        <h1>
                            {{currentCat}}
                        </h1>
                        <p>
                            Сервисы, похожие на Яндекс.Почта относятся к сфере электронная почта. Список отсортирован в
                            порядке уместности.
                            Чтобы найти подходящий аналог, сравните сервисы, прочтите описание и отзывы.
                        </p>
                    </div>
                </div>
            </section>
            <section class="description-box">
                <div class="container">
                    <div class="description-box--content">
                        <div class="description-box--content_elements">
                            {{servicesList[0]}}
                            <div class="description-el" v-for="(des,index) in servicesList"
                            >
                                <div class="description-el--top-content">
                                    <div class="logo-box">
                                        <nuxt-link :to="'/services/' + des.id" class="img-box">
                                            <div v-if="des.logo">
                                                <img :src="urlImage + 'services/' + des.logo" />
                                            </div>
                                            <div v-else><img src="/images/others/notimage.png"></div>
                                        </nuxt-link>
                                        <div class="rating-box">
                                            <el-rate
                                                v-model="des.assessmentRecommend"
                                                disabled
                                                :colors="colors">
                                            </el-rate>
                                            <p> ({{ des.reviews }} отзыв)</p>
                                        </div>
                                    </div>
                                    <div class="text-box">
                                        <div class="advertising" :class="{ 'is-active': des.advertising }">
                                            Реклама
                                        </div>
                                        <nuxt-link :to="'/services/' + des.id">
                                            {{ des.title }}
                                        </nuxt-link>
                                        <p v-if="des.desc">
                                            {{ des.desc }}
                                        </p>
                                        <p v-else>{{ des.content }}</p>
                                    </div>
                                    <div class="controls-box">
                                        <a :href="des.linkSite" target="_blank" data-text="Сайт" ></a>
                                        <div class="controls-box--input bookmarks-el">
                                            <input :id="'control1.0.1' + des.id" type="checkbox">
                                            <label :for="'control1.0.1' + des.id">
                                                В закладки
                                            </label>
                                        </div>
                                        <div class="controls-box--input">
                                            <input :id="'control1.0.2' + des.id" type="checkbox" :value="des.id" v-model="checkedServices" @change="changeCompare">
                                            <label :for="'control1.0.2' + des.id">
                                                Сравнить
                                            </label>
                                        </div>
                                        <div class="controls-box--input">
                                            <input :id="'control1.0.3' + des.id" type="checkbox">
                                            <label :for="'control1.0.3' + des.id">
                                                Использую
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="description-el--bottom-content" :class="{'is-active':mobile_list == index}" >
                                    <div class="will-do--category">
                                        <div class="top-box">
                                            <p>м <span>Малый бизнес</span></p>
                                            <p>с <span>Средний бизнес</span></p>
                                            <p>к <span>Крупный бизнес</span></p>
                                        </div>
                                        <div class="bottom-box">
                                            <span>B2B</span>
                                            <span>B2C</span>
                                        </div>

                                    </div>
                                    <div class="show-bottom--content">
                                        <p>Подойдёт для:</p>
                                        <div class="will-do">
                                            <div class="will-row">
                                                <input id="el1.1" type="checkbox">
                                                <label for="el1.1">
                                                    менеджер
                                                </label>
                                            </div>
                                            <div class="will-row">
                                                <input id="el1.2" type="checkbox">
                                                <label for="el1.2">
                                                    маркетолог
                                                </label>
                                            </div>
                                            <div class="will-row">
                                                <input id="el1.3" type="checkbox">
                                                <label for="el1.3">
                                                    блогер
                                                </label>
                                            </div>
                                            <div class="will-row">
                                                <input id="el1.4" type="checkbox">
                                                <label for="el1.4">
                                                    бизнес
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="arrow-show" :class="{'is-active':mobile_list == index}" @click="show_list_mobile(index)">
                                    <span v-if="mobile_list == index">
                                       Скрыть
                                    </span>
                                        <span v-else>
                                        Показать
                                    </span>
                                    </div>
                                </div>
                            </div>
                            {{checkedServices}}
<!--                            <div class="description-el">-->
<!--                                <div class="description-el&#45;&#45;top-content">-->
<!--                                    <div class="logo-box">-->
<!--                                        <a :href="descriptionElement[0].link" class="img-box">-->
<!--                                            <img :src="'/images/rec/' + descriptionElement[0].logo">-->
<!--                                        </a>-->
<!--                                        <div class="rating-box">-->
<!--                                            <div class="star-box">-->
<!--                                           <span>-->
<!--                                              <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="star" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svg-inline&#45;&#45;fa fa-star fa-w-18 fa-3x"><path fill="currentColor" d="M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z" class=""></path></svg>-->
<!--                                           </span>-->
<!--                                                <span>-->
<!--                                              <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="star" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svg-inline&#45;&#45;fa fa-star fa-w-18 fa-3x"><path fill="currentColor" d="M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z" class=""></path></svg>-->
<!--                                           </span>-->
<!--                                                <span>-->
<!--                                              <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="star" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svg-inline&#45;&#45;fa fa-star fa-w-18 fa-3x"><path fill="currentColor" d="M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z" class=""></path></svg>-->
<!--                                           </span>-->
<!--                                                <span>-->
<!--                                              <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="star" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svg-inline&#45;&#45;fa fa-star fa-w-18 fa-3x"><path fill="currentColor" d="M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z" class=""></path></svg>-->
<!--                                           </span>-->
<!--                                                <span>-->
<!--                                              <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="star" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svg-inline&#45;&#45;fa fa-star fa-w-18 fa-3x"><path fill="currentColor" d="M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z" class=""></path></svg>-->
<!--                                           </span>-->
<!--                                            </div>-->
<!--                                            <p> ({{ descriptionElement[0].reviews }} отзыв)</p>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                    <div class="text-box">-->
<!--                                        <div class="advertising" :class="{ 'is-active': descriptionElement[0].advertising }">-->
<!--                                            Реклама-->
<!--                                        </div>-->
<!--                                        <a :href="descriptionElement[0].link">-->
<!--                                            {{ descriptionElement[0].nameEl }}-->
<!--                                        </a>-->
<!--                                        <p> {{ descriptionElement[0].desc }}</p>-->
<!--                                    </div>-->
<!--                                    <div class="controls-box">-->
<!--                                        <a :href="descriptionElement[0].link" data-text="Сайт" ></a>-->
<!--                                        <div class="controls-box&#45;&#45;input bookmarks-el">-->
<!--                                            <input id="control1.0" type="checkbox">-->
<!--                                            <label for="control1.0">-->
<!--                                                В закладки-->
<!--                                            </label>-->
<!--                                        </div>-->
<!--                                        <div class="controls-box&#45;&#45;input">-->
<!--                                            <input id="control1.1" type="checkbox">-->
<!--                                            <label for="control1.1">-->
<!--                                                Сравнить-->
<!--                                            </label>-->
<!--                                        </div>-->
<!--                                        <div class="controls-box&#45;&#45;input">-->
<!--                                            <input id="control1.2" type="checkbox">-->
<!--                                            <label for="control1.2">-->
<!--                                                Использую-->
<!--                                            </label>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->

                        </div>
                        <aside>
                            <div class="aside-content">
                                <h2>
                                    Похожие категории
                                </h2>
                                <ul>
                                    <li v-for="item in catList">
                                        <a href="#" @click="selectCat(item.label)">{{item.label}}</a>
                                    </li>
                                </ul>
                                <nuxt-link to="/catalogs">
                                    <span data-text="Все категории"></span>
                                </nuxt-link>

                            </div>
                        </aside>
                    </div>
                </div>

                <div class="compare">
                    <div class="container">
                        <h6>Сравнить (<span>{{compareData.length}}</span>) {{currentCat}}</h6>
                        <div class="compare-content--box">
                            <div class="compare-content">
                                <div class="compare-box img-el" v-for="item in compareData">
                                    <img v-if="item.logo" :src="urlImage + 'services/' + item.logo" />
                                    <img v-else src="/images/others/notimage.png">
                                    <span  @click="removeCompare(item.id)"></span>
                                </div>
                                <div class="compare-box">
                                    <span></span>
                                </div>
                            </div>
                            <div class="button-box">
                            <span class="compare-button" data-compare="Сравнить сейчас">

                            </span>
                                <span class="reset-compare" @click="clearCompare">Очистить список</span>
                            </div>
                        </div>
                    </div>
                </div>

            </section>

        </main>

    </div>
</template>

<script>
    const baseUrlUploads = process.env.baseUrlImage;
    export default {
        name: "children_cat_index",
        data(){
            return {
                urlImage: baseUrlUploads,
                name: '',
                catList: [],
                servicesList: [],
                checkedServices: [],
                compareData: [],
                mobile_list: null,
                colors: ['#99A9BF', '#F7BA2A', '#FF9900'],
                descriptionElement: [
                    {
                        logo: '1.png',
                        star: 'star.jpg',
                        assessment: 3,
                        reviews: 169,
                        desc: 'Adaptive Discovery from Adaptive Insights is a cloud-based visualization platform with drag-and-drop design that allows end users to create visualizations without the need for IT resources. The solution can incorporate data from company’s...',
                        link: '#',
                        nameEl: 'Adaptive Discovery',
                        isActive: true,
                        advertising: true,
                    },
                    {
                        logo: '1.png',
                        star: 'star.jpg',
                        assessment: 3,
                        reviews: 169,
                        desc: 'Adaptive Discovery from Adaptive Insights is a cloud-based visualization platform with drag-and-drop design that allows end users to create visualizations without the need for IT resources. The solution can incorporate data from company’s...',
                        link: '#',
                        nameEl: 'Adaptive Discovery',
                        isActive: true,
                        advertising: true,
                    },
                    {
                        logo: '1.png',
                        star: 'star.jpg',
                        assessment: 3,
                        reviews: 169,
                        desc: 'Adaptive Discovery from Adaptive Insights is a cloud-based visualization platform with drag-and-drop design that allows end users to create visualizations without the need for IT resources. The solution can incorporate data from company’s...',
                        link: '#',
                        nameEl: 'Adaptive Discovery',
                        isActive: true,
                        advertising: false,
                    },
                    {
                        logo: '1.png',
                        star: 'star.jpg',
                        assessment: 3,
                        reviews: 169,
                        desc: 'Adaptive Discovery from Adaptive Insights is a cloud-based visualization platform with drag-and-drop design that allows end users to create visualizations without the need for IT resources. The solution can incorporate data from company’s...',
                        link: '#',
                        nameEl: 'Adaptive Discovery',
                        isActive: true,
                        advertising: false,
                    },
                    {
                        logo: '1.png',
                        star: 'star.jpg',
                        assessment: 3,
                        reviews: 169,
                        desc: 'Adaptive Discovery from Adaptive Insights is a cloud-based visualization platform with drag-and-drop design that allows end users to create visualizations without the need for IT resources. The solution can incorporate data from company’s...',
                        link: '#',
                        nameEl: 'Adaptive Discovery',
                        isActive: true,
                        advertising: false,
                    },
                    {
                        logo: '1.png',
                        star: 'star.jpg',
                        assessment: 3,
                        reviews: 169,
                        desc: 'Adaptive Discovery from Adaptive Insights is a cloud-based visualization platform with drag-and-drop design that allows end users to create visualizations without the need for IT resources. The solution can incorporate data from company’s...',
                        link: '#',
                        nameEl: 'Adaptive Discovery',
                        isActive: true,
                        advertising: false,
                    }
                ]
            }
        },
        methods: {
            changeCompare(){
                let allCheck = this.checkedServices;
                let allServiceCat = this.servicesList;
                let compare = [];
                for (let i = 0; i < allCheck.length; i++) {
                    let id = allCheck[i]
                    let targetCompare = allServiceCat.find((item) => {
                        if(item.id === id){return true}});
                    if(targetCompare){
                        compare.push(targetCompare)
                    }
                }
                this.compareData = compare
            },
            clearCompare(){
                this.checkedServices = [];
                this.compareData = [];
            },
            removeCompare(id){
                const unCheckEl = document.getElementById('control1.0.2' + id);
                unCheckEl.click();
            },
            getServices(cat){
                let servicesArr = []
                let lists = this.servicesAll;

                for (let i = 0; i < lists.length; i++) {
                    let catalogs = lists[i].cat
                    let format = this.formatCats(catalogs, cat)
                    if(format){
                        servicesArr.push(lists[i])
                    }
                }
                this.servicesList = servicesArr
            },
            formatCats(catalogs, cat){
                if(catalogs){
                    let mas = [],
                        j = 0;
                    for (let i = 0; i < catalogs.length; i++) {
                        if (catalogs[i] == ",") { j++; continue; }
                        else {
                            mas[j] ? mas[j] += catalogs[i] : mas[j] = catalogs[i];
                        }
                    }
                    for (let i = 0; i < mas.length; i++) {
                        if(mas[i] === cat){
                            return true
                        }
                    }
                }
            },
            show_list_mobile(index) {
                if(index == this.mobile_list){
                    this.mobile_list = null
                }else{
                    this.mobile_list = index
                }
            },
            selectCat(cat){
                this.$store.dispatch('data/search/GET_ACTIVE_CAT', cat)
            },
            getCats(cat, type){
                if(cat.length){
                    this.getServices(cat)
                    if(type !== 'change'){
                        let categoriesAll = this.categoryAll;
                        let childrenCat = [];
                        for (let i = 0; i < categoriesAll.length; i++) {
                            let catList = categoriesAll[i].categoryAll;
                            let targetCat = catList.find((item) => {
                                if(item.label === cat){return true}});
                            if(targetCat){
                                childrenCat.push(catList);
                            }
                        }
                        this.catList = childrenCat[0]
                    }
                } else {
                    this.$router.push('/catalogs')
                }
            }
        },
        watch: {
            currentCat(){
                this.getCats(this.currentCat, 'change')
            }
        },
        mounted() {
            this.name = this.$store.state.data.search.activeCat;
            this.getCats(this.name)
        },
        computed: {
            currentCat() {
                return this.$store.state.data.search.activeCat;
            },
            categoryAll() {
                return this.$store.state.data.category_data.categoryAll;
            },
            servicesAll() {
                return this.$store.state.data.services.services;
            },
        }
    }
</script>

<style scoped>

</style>
