<template>
    <div class="column-right">
        <div class="about-box">
            <h2>О себе</h2>
            <form action="">
                <div class="img-box">
                    <div class="img-el">
                        <div v-if="userData.logo">
                            <img id="image" :src="urlImage + 'users/' + userData.logo" alt="" />
                        </div>
                        <span v-else>
                            <svg aria-hidden="true" focusable="false" data-prefix="fal" data-icon="user" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-user fa-w-14 fa-3x"><path fill="currentColor" d="M313.6 288c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4zM416 464c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16v-41.6C32 365.9 77.9 320 134.4 320c19.6 0 39.1 16 89.6 16 50.4 0 70-16 89.6-16 56.5 0 102.4 45.9 102.4 102.4V464zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm0-224c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z" class=""></path></svg>
                        </span>
                    </div>
                    <input type="file" id="imageLogo" class="hidden" v-on:change="onImageChangeLogo" />
                    <input type="button" name="upload" id="upload" @click="uploadLogo" value="Загрузить" />
                </div>
                <div class="input-container">
                    {{userData}}
                    <hr>
                    <form @submit="formSubmit" ref="form" enctype="multipart/form-data">
                        <div class="input-row">
                            <div class="input-row--el">
                                <p>Имя</p>
                                <input type="text" v-model="userData.name">
                            </div>
                            <div class="input-row--el">
                                <p>Фамилия</p>
                                <input type="text" v-model="userData.surname">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-row--el">
                                <p>Профессия</p>
                                <input type="text" v-model="userData.profession">
                            </div>
                            <div class="input-row--el">
                                <p>Отрасль</p>
                                <el-select v-model="userData.industry" placeholder="Выбор отрасли" class="full">
                                    <el-option-group
                                        v-for="group in industriesAll"
                                        :key="group.label"
                                        :label="group.label">
                                        <el-option
                                            v-for="item in group.industriesAll"
                                            :key="item.value"
                                            :label="item.label"
                                            :value="item.value">
                                        </el-option>
                                    </el-option-group>
                                </el-select>
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-row--el">
                                <p>Название компании <span>(опционально)</span></p>
                                <input type="text"  v-model="userData.company">
                            </div>
                            <div class="input-row--el">
                                <p>Email</p>
                                <input type="email"  v-model="userData.email">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">Сохранить</button>
                        {{output}}
                    </form>

                </div>
            </form>
        </div>
    </div>
</template>

<script>
    const baseUrlUploads = process.env.baseUrlImage;
    import axios from "axios";
    export default {
        layout: 'lk',
        name: "index_lk",
        data() {
            return {
                id: '',
                urlImage: baseUrlUploads,
                logo: [],
                userData: [],
                options: [{
                    value: 'Option1',
                    label: 'Option1'
                }, {
                    value: 'Option2',
                    label: 'Option2'
                }, {
                    value: 'Option3',
                    label: 'Option3'
                }, {
                    value: 'Option4',
                    label: 'Option4'
                }, {
                    value: 'Option5',
                    label: 'Option5'
                }],
                value: '',
                colors: ['#99A9BF', '#F7BA2A', '#FF9900'],
                output: ''
            }
        },
        methods: {
            formSubmit(e) {

                e.preventDefault();
                let currentObj = this;
                const config = {
                    headers: { 'content-type': 'multipart/form-data' }
                }
                let formData = new FormData();

                formData.append('logo', this.logo);
                formData.append('name', this.userData.name);
                formData.append('email', this.userData.email);

                if(this.userData.surname !== null){
                    formData.append('surname', this.userData.surname);
                }
                if(this.userData.profession !== null){
                    formData.append('profession', this.userData.profession);
                }
                if(this.userData.profession !== null){
                    formData.append('company', this.userData.company);
                }
                if(this.userData.industry !== null){
                    formData.append('industry', this.userData.industry);
                }

                let uri = process.env.baseUrl + `user/update/${this.id}`;
                axios.post(uri,formData, config)
                    .then(function (response) {
                        currentObj.output = response.data;
                    })
                    .catch(function (error) {
                        currentObj.output = error;
                    });

            },
            uploadLogo(){
                const actionUploadLogo = document.getElementById('imageLogo');
                actionUploadLogo.click();
            },
            onImageChangeLogo(e){
                this.logo = e.target.files[0];
            },
            getData(id){
                this.id = id
                let uri = process.env.baseUrl + `user/${id}`;
                axios.get(uri).then((response) => {
                    this.userData = response.data
                });
            }
        },
        mounted() {
            this.getData(this.user.id)
        },

        computed: {
            industriesAll() {
                return this.$store.state.data.industries.industriesAll;
            },
        }
    }
</script>

<style scoped>

</style>
