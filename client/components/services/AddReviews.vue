<template>
    <div class="modal-block modal-image" :class="{ 'modal-auth': !isLogin }">
        <div class="modal-block-layout">
            <div @click="triggerModalImage"
                 class="modal-block-close"></div>
            <div class="modal-block-form">
                <div v-if="isLogin">
                    <div class="reviews-form">
                        <h2 class="title-h2">Оставьте отзыв</h2>

                        <form @submit="formSubmit" ref="form">
                            <div class="t-control box-control">
                                <span class="t-label">Плюсы*</span>
                                <el-input
                                    type="textarea"
                                    :rows="2"
                                    :autosize="{ minRows: 2, maxRows: 6}"
                                    v-model="comment_plus">
                                </el-input>
                            </div>
                            <div class="t-control box-control">
                                <span class="t-label">Минусы*</span>
                                <el-input
                                    type="textarea"
                                    :rows="2"
                                    :autosize="{ minRows: 2, maxRows: 6}"
                                    v-model="comment_minus">
                                </el-input>
                            </div>
                            <div class="t-control box-control">
                                <span class="t-label">В целом*</span>
                                <el-input
                                    type="textarea"
                                    :rows="2"
                                    :autosize="{ minRows: 2, maxRows: 6}"
                                    v-model="comment_all">
                                </el-input>
                            </div>
                            <div class="control-flex">
                                <div class="t-control box-control">
                                    <span class="t-label">Простота использования</span>
                                    <el-rate
                                        v-model="rating_use"
                                        :colors="colors">
                                    </el-rate>
                                </div>
                                <div class="t-control box-control">
                                    <span class="t-label">Поддержка</span>
                                    <el-rate
                                        v-model="rating_support"
                                        :colors="colors">
                                    </el-rate>
                                </div>
                            </div>
                            <div class="t-control box-control">
                                <span class="t-label">Соответствие цены качеству</span>
                                <el-rate
                                    v-model="rating_quality"
                                    :colors="colors">
                                </el-rate>
                            </div>
                            <div class="control-flex">
                                <div class="t-control box-control">
                                    <span class="t-label">Возможности</span>
                                    <el-rate
                                        v-model="rating_features"
                                        :colors="colors">
                                    </el-rate>
                                </div>
                                <div class="t-control box-control">
                                    <span class="t-label">Вероятность что буду рекомендовать</span>
                                    <el-rate
                                        v-model="rating_recommendation"
                                        :colors="colors">
                                    </el-rate>
                                </div>
                            </div>

                            <div class="t-control box-control">
                                <span class="t-label">Ваша должность</span>
                                <el-input
                                    type="text"
                                    v-model="position">
                                </el-input>
                            </div>
                            <input type="hidden" class="t-input" id="serviceID" v-model="id" />
                            <input type="hidden" class="t-input" id="userID" v-model="userInfo.id" />

                            <button class="button t-button blue" id="sub_create">Оставить отзыв</button>
                        </form>
                    </div>
                </div>
                <div v-else>
                    <modal-auth :id="id" cat=""/>
                </div>
            </div>

        </div>
    </div>
</template>

<script>
    import modalAuth from '@/components/base/auth/modalAuth';
    import axios from "axios";
    export default {
        props: ['id'],
        name: "AddReviews",
        components: {
            modalAuth
        },
        data() {
            return {
                colors: ['#99A9BF', '#F7BA2A', '#FF9900'], //rate
                comment_plus: '',
                comment_minus: '',
                comment_all: '',
                rating_use: 0,
                rating_support: 0,
                rating_quality: 0,
                rating_features: 0,
                rating_recommendation: 0,
                position: '',

                output: ''
            }
        },
        methods: {
            formSubmit(e){
                e.preventDefault();
                let currentObj = this;
                const service_id = document.getElementById('serviceID'),
                    user_id = document.getElementById('userID');

                let formData = new FormData();
                formData.append('comment_plus', this.comment_plus);
                formData.append('comment_minus', this.comment_minus);
                formData.append('comment_all', this.comment_all);
                formData.append('rating_use', this.rating_use);
                formData.append('rating_support', this.rating_support);
                formData.append('rating_quality', this.rating_quality);
                formData.append('rating_features', this.rating_features);
                formData.append('rating_recommendation', this.rating_recommendation);
                formData.append('position', this.position);

                formData.append('service_id', service_id.value);
                formData.append('user_id', user_id.value);
                formData.append('is_publish', 0);

                let uri = process.env.baseUrl + `reviews/create`;
                if(this.comment_plus.length && this.comment_minus.length && this.comment_all.length){
                    axios.post(uri,formData)
                        .then(function (response) {
                            currentObj.output = response.data;
                        })
                        .catch(function (error) {
                            currentObj.output = error;
                        });
                    this.endForm()
                } else {
                    this.$notify({
                        title: 'Предупреждение',
                        message: this.userInfo.name + ', заполните все поля!',
                        type: 'warning'
                    });
                }


            },
            endForm(){
                this.$notify({
                    title: 'Успех',
                    message: this.userInfo.name + ' Ваш отзыв оставлен',
                    type: 'success'
                });
                const service_id = document.getElementById('serviceID'),
                    user_id = document.getElementById('userID');
                service_id.value = ''
                user_id.value = ''

                    this.comment_plus = ''
                    this.comment_minus = ''
                    this.comment_all = ''
                    this.rating_use = 0
                    this.rating_support = 0
                    this.rating_quality = 0
                    this.rating_features = 0
                    this.rating_recommendation = 0
                    this.position = ''

                this.triggerModalImage();
            },
            triggerModalImage() {
                this.$store.dispatch('others/modals/SET_MODAL_IMAIGE');
            },
        },
        computed: {
            isLogin() {
                return this.$store.state.auth.loggedIn;
            },
            userInfo() {
                return this.$store.state.auth.user;
            },
            //loggedIn
        }
    }
</script>

<style scoped>

</style>
