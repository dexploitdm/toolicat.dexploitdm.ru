<template>
    <div>
        <div class="give-feedback is-active">
            <div class="popup-content">
                <span class="close" @click="closeModal"></span>
                <h2>Оставить отзыв</h2>
                <form @submit="formSubmit" ref="form">
                    <div class="form-el">
                        <p>Простота использования</p>
                        <el-slider v-model="rating_use" :max="maxRate" />
                    </div>
                    <div class="form-el">
                        <p>Поддержка</p>
                        <el-slider v-model="rating_support" :max="maxRate" />
                    </div>
                    <div class="form-el">
                        <p>Соответствие цены качеству</p>
                        <el-slider v-model="rating_quality" :max="maxRate" />
                    </div>
                    <div class="form-el">
                        <p>Возможности</p>
                        <el-slider v-model="rating_features" :max="maxRate" />
                    </div>
                    <div class="form-el">
                        <p>Вероятность что буду рекомендовать</p>
                        <el-slider v-model="rating_recommendation" :max="maxRate" />
                    </div>
                    <div class="form-el column-box">
                        <p>Плюсы</p>
                        <textarea name="textarea1"  v-model="comment_plus"/>
                    </div>
                    <div class="form-el column-box">
                        <p>Минусы</p>
                        <textarea name="textarea2" v-model="comment_minus"/>
                    </div>
                    <div class="form-el column-box">
                        <p>В целом</p>
                        <textarea name="textarea3" v-model="comment_all"/>
                    </div>
                    <div class="t-control box-control">
                        <span class="t-label">Ваша соц. сеть (необязательно)</span>
                        <span v-if="soc_icon">Выбрана {{soc_icon}} <span @click="changeSoc">Сменить</span></span>
                        <div v-else class="soc-blocks">
                            <div class="s-icon-item fb" @click="selectSoc('instagram')">
                                instagram
                            </div>
                            <div class="s-icon-item fb" @click="selectSoc('vk')">
                                vk
                            </div>
                            <div class="s-icon-item fb" @click="selectSoc('facebook')">
                                facebook
                            </div>
                            <div class="s-icon-item fb" @click="selectSoc('linkedin')">
                                linkedin
                            </div>
                        </div>
                    </div>
                    <div class="t-control box-control">
                        <span class="t-label">Ссылка на Вашу соц. сеть (необязательно)</span>
                        <el-input
                            type="text"
                            v-model="soc_link">
                        </el-input>
                    </div>

                    <input type="hidden" class="t-input" id="serviceID" v-model="id" />
                    <input type="hidden" class="t-input" id="userID" v-model="userInfo.id" />

                    <button type="submit">Оставить отзыв</button>
                </form>
            </div>
        </div>

    </div>
</template>

<script>
    import modalAuth from '@/components/base/auth/modalAuth';
    import axios from "axios";
    export default {
        props: ['id'],
        name: "AddReviews",
        components: {
            modalAuth
        },
        data() {
            return {
                colors: ['#99A9BF', '#F7BA2A', '#FF9900'], //rate
                maxRate: 5,
                comment_plus: '',
                comment_minus: '',
                comment_all: '',
                rating_use: 0,
                rating_support: 0,
                rating_quality: 0,
                rating_features: 0,
                rating_recommendation: 0,
                soc_icon: '',
                soc_link: '',

                output: ''
            }
        },
        methods: {
            formSubmit(e){
                e.preventDefault();
                let currentObj = this;
                const service_id = document.getElementById('serviceID'),
                    user_id = document.getElementById('userID');

                let formData = new FormData();
                formData.append('comment_plus', this.comment_plus);
                formData.append('comment_minus', this.comment_minus);
                formData.append('comment_all', this.comment_all);
                formData.append('rating_use', this.rating_use);
                formData.append('rating_support', this.rating_support);
                formData.append('rating_quality', this.rating_quality);
                formData.append('rating_features', this.rating_features);
                formData.append('rating_recommendation', this.rating_recommendation);
                formData.append('soc_icon', this.soc_icon);
                formData.append('soc_link', this.soc_link);
                formData.append('like_r', 0);

                formData.append('service_id', service_id.value);
                formData.append('user_id', user_id.value);
                formData.append('is_publish', 0);

                let uri = process.env.baseUrl + `reviews/create`;
                if(this.comment_plus.length && this.comment_minus.length && this.comment_all.length){
                    axios.post(uri,formData)
                        .then(function (response) {
                            currentObj.output = response.data;
                        })
                        .catch(function (error) {
                            currentObj.output = error;
                        });
                    this.endForm()
                } else {
                    this.$notify({
                        title: 'Предупреждение',
                        message: this.userInfo.name + ', заполните все поля!',
                        type: 'warning'
                    });
                }


            },
            endForm(){
                this.$notify({
                    title: 'Успех',
                    message: this.userInfo.name + ' Ваш отзыв оставлен',
                    type: 'success'
                });
                const service_id = document.getElementById('serviceID'),
                    user_id = document.getElementById('userID');
                service_id.value = ''
                user_id.value = ''

                    this.comment_plus = ''
                    this.comment_minus = ''
                    this.comment_all = ''
                    this.rating_use = 0
                    this.rating_support = 0
                    this.rating_quality = 0
                    this.rating_features = 0
                    this.rating_recommendation = 0
                    this.position = ''

                this.closeModal();
            },
            selectSoc(soc){
                this.soc_icon = soc;
            },
            changeSoc(){
                this.soc_icon = '';
            },
            closeModal() {
                this.$store.dispatch('others/modals/SET_MODAL_REVIEWS');
            },
        },
        computed: {
            isLogin() {
                return this.$store.state.auth.loggedIn;
            },
            userInfo() {
                return this.$store.state.auth.user;
            },
            //loggedIn
        }
    }
</script>

<style scoped>

</style>
